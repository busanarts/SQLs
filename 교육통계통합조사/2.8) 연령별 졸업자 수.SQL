SELECT HG_KNAME 학과,
	   NVL( SUM( CASE WHEN AGE <= 15 AND HJ_SEXGBN = '1' THEN 1 END ), 0 ) "<15(남)",
	   NVL( SUM( CASE WHEN AGE <= 15 AND HJ_SEXGBN = '2' THEN 1 END ), 0 ) "<15(여)",
	   NVL( SUM( CASE WHEN AGE = 16 AND HJ_SEXGBN = '1' THEN 1 END ), 0 ) "16(남)",
       NVL( SUM( CASE WHEN AGE = 16 AND HJ_SEXGBN = '2' THEN 1 END ), 0 ) "16(여)",
       NVL( SUM( CASE WHEN AGE = 17 AND HJ_SEXGBN = '1' THEN 1 END ), 0 ) "17(남)",
       NVL( SUM( CASE WHEN AGE = 17 AND HJ_SEXGBN = '2' THEN 1 END ), 0 ) "17(여)",
       NVL( SUM( CASE WHEN AGE = 18 AND HJ_SEXGBN = '1' THEN 1 END ), 0 ) "18(남)",
       NVL( SUM( CASE WHEN AGE = 18 AND HJ_SEXGBN = '2' THEN 1 END ), 0 ) "18(여)",
       NVL( SUM( CASE WHEN AGE = 19 AND HJ_SEXGBN = '1' THEN 1 END ), 0 ) "19(남)",
       NVL( SUM( CASE WHEN AGE = 19 AND HJ_SEXGBN = '2' THEN 1 END ), 0 ) "19(여)",
       NVL( SUM( CASE WHEN AGE = 20 AND HJ_SEXGBN = '1' THEN 1 END ), 0 ) "20(남)",
       NVL( SUM( CASE WHEN AGE = 20 AND HJ_SEXGBN = '2' THEN 1 END ), 0 ) "20(여)",
       NVL( SUM( CASE WHEN AGE = 21 AND HJ_SEXGBN = '1' THEN 1 END ), 0 ) "21(남)",
       NVL( SUM( CASE WHEN AGE = 21 AND HJ_SEXGBN = '2' THEN 1 END ), 0 ) "21(여)",
       NVL( SUM( CASE WHEN AGE = 22 AND HJ_SEXGBN = '1' THEN 1 END ), 0 ) "22(남)",
       NVL( SUM( CASE WHEN AGE = 22 AND HJ_SEXGBN = '2' THEN 1 END ), 0 ) "22(여)",
       NVL( SUM( CASE WHEN AGE = 23 AND HJ_SEXGBN = '1' THEN 1 END ), 0 ) "23(남)",
       NVL( SUM( CASE WHEN AGE = 23 AND HJ_SEXGBN = '2' THEN 1 END ), 0 ) "23(여)",
       NVL( SUM( CASE WHEN AGE = 24 AND HJ_SEXGBN = '1' THEN 1 END ), 0 ) "24(남)",
       NVL( SUM( CASE WHEN AGE = 24 AND HJ_SEXGBN = '2' THEN 1 END ), 0 ) "24(여)",
       NVL( SUM( CASE WHEN AGE = 25 AND HJ_SEXGBN = '1' THEN 1 END ), 0 ) "25(남)",
       NVL( SUM( CASE WHEN AGE = 25 AND HJ_SEXGBN = '2' THEN 1 END ), 0 ) "25(여)",
       NVL( SUM( CASE WHEN AGE = 26 AND HJ_SEXGBN = '1' THEN 1 END ), 0 ) "26(남)",
       NVL( SUM( CASE WHEN AGE = 26 AND HJ_SEXGBN = '2' THEN 1 END ), 0 ) "26(여)",
       NVL( SUM( CASE WHEN AGE = 27 AND HJ_SEXGBN = '1' THEN 1 END ), 0 ) "27(남)",
       NVL( SUM( CASE WHEN AGE = 27 AND HJ_SEXGBN = '2' THEN 1 END ), 0 ) "27(여)",
       NVL( SUM( CASE WHEN AGE = 28 AND HJ_SEXGBN = '1' THEN 1 END ), 0 ) "28(남)",
       NVL( SUM( CASE WHEN AGE = 28 AND HJ_SEXGBN = '2' THEN 1 END ), 0 ) "28(여)",
       NVL( SUM( CASE WHEN AGE = 29 AND HJ_SEXGBN = '1' THEN 1 END ), 0 ) "29(남)",
       NVL( SUM( CASE WHEN AGE = 29 AND HJ_SEXGBN = '2' THEN 1 END ), 0 ) "29(여)",
       NVL( SUM( CASE WHEN AGE >= 30 AND AGE <= 34 AND HJ_SEXGBN = '1' THEN 1 END ), 0 ) "~34(남)",
       NVL( SUM( CASE WHEN AGE >= 30 AND AGE <= 34 AND HJ_SEXGBN = '2' THEN 1 END ), 0 ) "~34(여)",
       NVL( SUM( CASE WHEN AGE >= 35 AND AGE <= 39 AND HJ_SEXGBN = '1' THEN 1 END ), 0 ) "35~(남)",
       NVL( SUM( CASE WHEN AGE >= 35 AND AGE <= 39 AND HJ_SEXGBN = '2' THEN 1 END ), 0 ) "35~(여)",
       NVL( SUM( CASE WHEN AGE >= 40 AND AGE <= 49 AND HJ_SEXGBN = '1' THEN 1 END ), 0 ) "40~(남)",
       NVL( SUM( CASE WHEN AGE >= 40 AND AGE <= 49 AND HJ_SEXGBN = '2' THEN 1 END ), 0 ) "40~(여)",
       NVL( SUM( CASE WHEN AGE >= 50 AND AGE <= 59 AND HJ_SEXGBN = '1' THEN 1 END ), 0 ) "50~(남)",
       NVL( SUM( CASE WHEN AGE >= 50 AND AGE <= 59 AND HJ_SEXGBN = '2' THEN 1 END ), 0 ) "50~(여)",
       NVL( SUM( CASE WHEN AGE >= 60 AND HJ_SEXGBN = '1' THEN 1 END ), 0 ) "60>(남)",
       NVL( SUM( CASE WHEN AGE >= 60 AND HJ_SEXGBN = '2' THEN 1 END ), 0 ) "60>(여)"
FROM
	(SELECT HG_KNAME, HJ_HAKBUN, HJ_SEXGBN, AGE(HJ_JCODE1, :학년도 || '0301') AGE
    FROM AC12011_20140401, AC1121
	WHERE HJ_STATE IN ('81', '82', '83')
	AND HJ_HGCODE = HG_CODE
	AND HJ_JYMD > TO_CHAR(:학년도 - 1) ||'08'
	AND HJ_HGCODE = HG_CODE
	)
GROUP BY CUBE(hg_kname)
ORDER BY hg_kname