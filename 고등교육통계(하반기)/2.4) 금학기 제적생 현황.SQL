-- 12) 금학기 제적생 현황
SELECT 학과명, 학년, MAX(DECODE(hb_name, '미등록', 인원, 0)) 미등록,
MAX(DECODE(hb_name, '미복학', 인원, 0)) 미복학, MAX(DECODE(hb_name, '자퇴', 인원, 0)) 자퇴,
MAX(DECODE(hb_name, '학사제적', 인원, 0)) 학사제적
from
(SELECT 학과명, HJ_HAKNYUN 학년, HB_NAME, COUNT(*) 인원  FROM AC12011_2012_10_01, (
	SELECT HC_HAKBUN, HC_SCODE, HB_NAME, HC_SIYMD FROM AC1202_2012_10_01 A1, AC1104
	WHERE (HC_HAKBUN, HC_SIYMD) IN (SELECT HC_HAKBUN, MAX(HC_SIYMD) FROM AC1202_2012_10_01
	WHERE HC_HAKBUN = A1.HC_HAKBUN
	GROUP BY HC_HAKBUN)
	AND HC_SCODE = HB_CODE
), AC1121, TBL학과
WHERE HJ_HAKBUN = HC_HAKBUN
AND hj_jhgbn < '50'
  AND SUBSTR(hj_state,1,1) = '2'
AND hj_hakbun NOT LIKE 'T%'
AND SUBSTR(HC_SCODE,1,1) = '2'
AND HC_SIYMD >= :학년도 || '0401' AND HC_SIYMD <= :학년도 || '0931'
AND HJ_HGCODE = HG_CODE AND HG_MCODE = 학과코드
GROUP BY 학과명, HJ_HAKNYUN, HB_NAME)
GROUP BY 학과명, 학년
ORDER BY 학과명, 학년